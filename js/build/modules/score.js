"use strict";define(["knockout","pubsub"],function(e,r){var a=75;return function(s){function o(){var e,a=s.players(),o=c.topScore();c.leadPlayers.removeAll();for(e in a)a[e].leadScore(!1),a[e].tiedScore(!1),a[e].currentScore()>=o&&c.leadPlayers.push(a[e]);if(!o)return!1;if(c.leadPlayers().length>1)for(e in c.leadPlayers())c.leadPlayers()[e].tiedScore(!0);else c.leadPlayers()[0].leadScore(!0);r.publish("score.leaders",c.leadPlayers())}var c=this;this.leadPlayers=e.observableArray([]),this.gameEndScore=e.observable(a),this.closeModal=e.observable(!1),this.topScore=e.pureComputed(function(){if(!s.players()[0])return!1;var e,r=s.players(),a=r[0].currentScore(),o=!0;for(e in r)0!==r[e].currentScore()&&(o=!1),r[e].currentScore()>a&&(a=r[e].currentScore());return!o&&a}),this.clearScores=function(){var e,r=s.players();for(e in r)r[e].currentScore(0)},this.leadPlayerName=e.pureComputed(function(){var e=c.leadPlayers();return 1===e.length?e[0].name():e.length>1?"Tied!":void 0}),this.gameEndScore.subscribe(function(){r.publish("game.save",{}),r.publish("game.score.change",{})}),this.remainingPoints=e.pureComputed(function(){var e=c.gameEndScore()-c.topScore();return e>0?e:0}),r.subscribe("score.update",function(){o.call(this)}),r.subscribe("game.ready",o.bind(this)),r.subscribe("perist.load",function(e,r){r.hasOwnProperty("score")&&c.gameEndScore(r.score),o.call(c)}),r.subscribe("game.reset",function(){c.clearScores()})}});