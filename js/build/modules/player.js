"use strict";define(["knockout","pubsub"],function(e,r){function o(e){e&&(c=e);var r=c++;return 0===c&&(r=0),c++,r}function n(e){if(e){var r=s.indexOf(e);l=r+1}l>=s.length&&(l=0);var o=s[l];return l++,o}var c=0,t=0,u=!0,s=["blue","yellow","green","orange"],l=0;return function(c){c=c||{};var s=this;s.id=o(c.id),s.name=e.observable(c.name),s.score=e.observable(c.currentScore||0),s.color=e.observable(c.color||n()),s.currentRoundScore=e.observable(),s.leadScore=e.observable(!1),s.tiedScore=e.observable(!1),s.scoreInput=e.observable(),s.roundScore=e.observable(c.roundScore),s.roundScoreVisible=e.observable(!1),s.lastRecordedRound=e.observable(c.lastRecordedRound||0),s.allScores=e.observableArray(c.allScores||[]),s.allScoresVisible=e.observable(!1),s.swipeResult=e.observable(!1),s.colorVariable=function(){return"--player-color: var(--"+s.color()+"); --player-color-r: var(--"+s.color()+"-r); --player-color-g: var(--"+s.color()+"-g); --player-color-b: var(--"+s.color()+"-b)"},s.changeColor=function(){var e=s.color();s.color(n(e))},s.currentScore=e.pureComputed({read:function(){return s.score()},write:function(e){return s.score(e)}}),s.elementId=function(){return"player_"+s.id},s.editingName=e.observable(!(s.name()&&s.name().length>0)),s.editName=function(){s.editingName(!0)},s.score.subscribe(function(){u&&(s.incrementRound(),s.roundScoreVisible(!0),s.allScores.push({total:s.score(),round:s.roundScore()}),r.publish("score.update",s),r.publish("game.save",{}))}),s.silentScoreUpdate=function(e){u=!1,s.score(e),u=!0},s.editingName.subscribe(function(){s.editingName()||s.name()&&!(s.name().length<1)||s.name("Blitzer #"+s.id)}),s.scoreInputIsEmpty=e.pureComputed(function(){return!(s.scoreInput()&&s.scoreInput().length>0)}),s.renderRoundScore=e.pureComputed(function(){return s.roundScore(),t>0?"+"+t:t}),s.toggleAllScoreVisibility=function(){s.allScores().length>0&&s.allScoresVisible(!s.allScoresVisible())},s.showRoundScore=e.pureComputed(function(){return s.currentScore(),!!s.roundScoreVisible()&&(setTimeout(function(){s.roundScoreVisible(!1)},1500),!0)});var l=!0;s.incrementRound=function(e){var o=s.lastRecordedRound();l&&(s.lastRecordedRound(o+1),l=!1,e||r.publish("round.update",s)),setTimeout(function(){l=!0},6e4)},s.addScore=function(){s.score(parseInt(s.roundScore()||0)+parseInt(s.score())),t=s.roundScore(),s.roundScore(null)},s.minusScore=function(e,r){r.currentTarget.focus(),s.roundScore(s.roundScore()*-1),s.score(parseInt(s.roundScore()||0)+parseInt(s.score())),t=s.roundScore(),s.roundScore(null)};var i=1,a=2;s.swipeGesture=function(e,r){r.direction===a&&"left"!==s.swipeResult()?s.swipeResult("left"):s.swipeResult(!1),r.direction===i&&"left"===s.swipeResult()&&s.swipeResult(!1),r.preventDefault()},s.resetScores=function(){s.allScores([]),s.allScoresVisible(!1)},r.subscribe("round.complete",function(){l=!0}),r.subscribe("game.reset",this.resetScores),r.subscribe("game.clear",this.resetScores)}});