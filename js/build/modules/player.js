"use strict";define(["knockout","pubsub"],function(e,r){function o(e){e&&(u=e);var r=u++;return 0===u&&(r=0),u++,r}function n(e){if(e){var r=c.indexOf(e);t=r+1}t>=c.length&&(t=0);var o=c[t];return t++,o}var u=0,c=["blue","yellow","green","orange"],t=0;return function(u){u=u||{};var c=this;c.id=o(u.id),c.name=e.observable(u.name),c.score=e.observable(u.currentScore||0),c.color=e.observable(u.color||n()),c.currentRoundScore=e.observable(),c.leadScore=e.observable(!1),c.tiedScore=e.observable(!1),c.scoreInput=e.observable(),c.roundScore=e.observable(u.roundScore),c.roundScoreVisible=e.observable(!1),c.scoreFocus=e.observable(!1),c.lastRecordedRound=e.observable(u.lastRecordedRound||0),c.colorVariable=function(){return"--player-color: var(--"+c.color()+")"},c.changeColor=function(){var e=c.color();c.color(n(e))},c.currentScore=e.pureComputed({read:function(){return c.score(parseInt(c.roundScore()||0)+parseInt(c.score())),c.currentRoundScore(c.roundScore()),c.roundScore(null),c.score()},write:function(e){c.score(e)}}),c.elementId=function(){return"player_"+c.id},c.editingName=e.observable(!(c.name()&&c.name().length>0)),c.editName=function(){c.editingName(!0)},c.updateScore=function(){},c.currentScore.subscribe(function(){c.incrementRound(),c.roundScoreVisible(!0),r.publish("score.update",c),r.publish("game.save",{})}),c.editingName.subscribe(function(){c.editingName()||c.name()&&!(c.name().length<1)||c.name("Blitzer #"+c.id)}),c.scoreInputIsEmpty=e.pureComputed(function(){return!(c.scoreInput()&&c.scoreInput().length>0)}),c.renderRoundScore=e.pureComputed(function(){return c.currentRoundScore()>0?"+"+c.currentRoundScore():c.currentRoundScore()/2}),c.showRoundScore=e.pureComputed(function(){return c.currentScore(),!!c.roundScoreVisible()&&(setTimeout(function(){c.roundScoreVisible(!1)},1500),!0)});var t=!0;c.incrementRound=function(e){var o=c.lastRecordedRound();t&&(c.lastRecordedRound(o+1),t=!1,e||r.publish("round.update",c)),setTimeout(function(){t=!0},3e4)},c.minusScore=function(){var e=this.currentRoundScore()*-1*2;c.roundScore(e)},r.subscribe("round.complete",function(){t=!0})}});