"use strict";define(["knockout","pubsub"],function(e,r){function o(e){e&&(c=e);var r=c++;return 0===c&&(r=0),c++,r}function n(e){if(e){var r=u.indexOf(e);t=r+1}t>=u.length&&(t=0);var o=u[t];return t++,o}var c=0,u=["blue","yellow","green","orange"],t=0;return function(c){c=c||{};var u=this;u.id=o(c.id),u.name=e.observable(c.name),u.score=e.observable(c.currentScore||0),u.color=e.observable(c.color||n()),u.currentRoundScore=e.observable(),u.leadScore=e.observable(!1),u.tiedScore=e.observable(!1),u.scoreInput=e.observable(),u.roundScore=e.observable(c.roundScore),u.roundScoreVisible=e.observable(!1),u.lastRecordedRound=e.observable(c.lastRecordedRound||0),u.colorVariable=function(){return"--player-color: var(--"+u.color()+"); --player-color-r: var(--"+u.color()+"-r); --player-color-g: var(--"+u.color()+"-g); --player-color-b: var(--"+u.color()+"-b)"},u.changeColor=function(){var e=u.color();u.color(n(e))},u.currentScore=e.pureComputed({read:function(){return u.currentRoundScore(u.roundScore()),u.score()},write:function(e){console.log("updating score"),u.score(e)}}),u.elementId=function(){return"player_"+u.id},u.editingName=e.observable(!(u.name()&&u.name().length>0)),u.editName=function(){u.editingName(!0)},u.score.subscribe(function(){u.incrementRound(),u.roundScoreVisible(!0),r.publish("score.update",u),r.publish("game.save",{})}),u.editingName.subscribe(function(){u.editingName()||u.name()&&!(u.name().length<1)||u.name("Blitzer #"+u.id)}),u.scoreInputIsEmpty=e.pureComputed(function(){return!(u.scoreInput()&&u.scoreInput().length>0)}),u.renderRoundScore=e.pureComputed(function(){return u.currentRoundScore()>0?"+"+u.currentRoundScore():u.currentRoundScore()/2}),u.showRoundScore=e.pureComputed(function(){return u.currentScore(),!!u.roundScoreVisible()&&(setTimeout(function(){u.roundScoreVisible(!1)},1500),!0)});var t=!0;u.incrementRound=function(e){var o=u.lastRecordedRound();t&&(u.lastRecordedRound(o+1),t=!1,e||r.publish("round.update",u)),setTimeout(function(){t=!0},6e4)},u.addScore=function(){u.score(parseInt(u.roundScore()||0)+parseInt(u.score())),u.roundScore(null)},u.minusScore=function(e,r){console.log("subtracting score"),r.currentTarget.focus(),u.roundScore(u.roundScore()*-1),u.score(parseInt(u.roundScore()||0)+parseInt(u.score())),u.roundScore(null)},r.subscribe("round.complete",function(){t=!0})}});