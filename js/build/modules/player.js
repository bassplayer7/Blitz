"use strict";define(["knockout","pubsub"],function(e,r){function o(e){e&&(u=e);var r=u++;return 0===u&&(r=0),u++,r}function n(e){if(e){var r=t.indexOf(e);i=r+1}i>=t.length&&(i=0);var o=t[i];return i++,o}var u=0,c=0,t=["blue","yellow","green","orange"],i=0;return function(u){u=u||{};var t=this;t.id=o(u.id),t.name=e.observable(u.name),t.score=e.observable(u.currentScore||0),t.color=e.observable(u.color||n()),t.currentRoundScore=e.observable(),t.leadScore=e.observable(!1),t.tiedScore=e.observable(!1),t.scoreInput=e.observable(),t.roundScore=e.observable(u.roundScore),t.roundScoreVisible=e.observable(!1),t.lastRecordedRound=e.observable(u.lastRecordedRound||0),t.swipeResult=e.observable(!1),t.colorVariable=function(){return"--player-color: var(--"+t.color()+"); --player-color-r: var(--"+t.color()+"-r); --player-color-g: var(--"+t.color()+"-g); --player-color-b: var(--"+t.color()+"-b)"},t.changeColor=function(){var e=t.color();t.color(n(e))},t.currentScore=e.pureComputed({read:function(){return t.score()},write:function(e){console.log("updating score"),t.score(e)}}),t.elementId=function(){return"player_"+t.id},t.editingName=e.observable(!(t.name()&&t.name().length>0)),t.editName=function(){t.editingName(!0)},t.score.subscribe(function(){t.incrementRound(),t.roundScoreVisible(!0),r.publish("score.update",t),r.publish("game.save",{})}),t.editingName.subscribe(function(){t.editingName()||t.name()&&!(t.name().length<1)||t.name("Blitzer #"+t.id)}),t.scoreInputIsEmpty=e.pureComputed(function(){return!(t.scoreInput()&&t.scoreInput().length>0)}),t.renderRoundScore=e.pureComputed(function(){return t.roundScore(),c}),t.showRoundScore=e.pureComputed(function(){return t.currentScore(),!!t.roundScoreVisible()&&(setTimeout(function(){t.roundScoreVisible(!1)},1500),!0)});var i=!0;t.incrementRound=function(e){var o=t.lastRecordedRound();i&&(t.lastRecordedRound(o+1),i=!1,e||r.publish("round.update",t)),setTimeout(function(){i=!0},6e4)},t.addScore=function(){t.score(parseInt(t.roundScore()||0)+parseInt(t.score())),c=t.roundScore(),t.roundScore(null)},t.minusScore=function(e,r){console.log("subtracting score"),r.currentTarget.focus(),t.roundScore(t.roundScore()*-1),t.score(parseInt(t.roundScore()||0)+parseInt(t.score())),c=t.roundScore(),t.roundScore(null)};var s=1,l=2;t.swipeGesture=function(e,r){r.direction===l&&"left"!==t.swipeResult()?t.swipeResult("left"):t.swipeResult(!1),r.direction===s&&"left"===t.swipeResult()&&t.swipeResult(!1),r.preventDefault()},r.subscribe("round.complete",function(){i=!0})}});