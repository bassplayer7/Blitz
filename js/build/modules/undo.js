"use strict";define(["knockout","pubsub"],function(e,s){return function(r){var t=this;this.game=r,this.plays=e.observableArray([]),this.execute=function(){var s=t.plays.pop(),r=e.utils.arrayFirst(this.game.players(),function(e){return s===e.id});if(!r)return!1;var a=r.score();r.silentScoreUpdate(a+t.getLastScoreFor(r)*-1)},this.getLastScoreFor=function(e){var s=e.allScores.pop();return s?parseInt(s.round):0},this.resetPlays=function(){t.plays.removeAll()},s.subscribe("score.update",function(e,s){t.plays.push(s.id)}),s.subscribe("perist.load",function(e,s){s.hasOwnProperty("undo")&&t.plays(s.undo)}),s.subscribe("game.reset",this.resetPlays),s.subscribe("game.clear",this.resetPlays)}});